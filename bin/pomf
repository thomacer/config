#!/usr/bin/env bash
# upload images to pomf: requires jshon

usage() {
    cat <<EOF
    -h      | Print this message.
    default | Use the 1339.cf pomf fork.
    -m      | Use maxfile.ro pomf fork.
            |
    else    | Take the two other argument, to select
            | a specific poomf fork.
            | ex: pomf <url> <result_url>
EOF
}

image=""
ext="(\.jpg|\.png|\.gif)$"

pomf_fork="http://www.1339.cf/"
result_url="http://b.1339.cf/"
for arg in "$@"
do
    case "$arg" in
        -h) usage
            exit 0
            ;;
        -m) pomf_fork="https://www.maxfile.ro/"
            result_url="https://d.maxfile.ro/"
            ;;
        * ) image="$arg"
            ;;
    esac
done

if (( $# == 0 )); then
  printf '%s\n' "Usage: ${0##*/} IMAGE"
  exit 1
elif [[ $image =~ $ext ]]; then
  up=$(curl -sf -F files[]=@"$image" "$pomf_fork""upload.php")
  url=$(jshon -e files -a -e url -u <<< "$up")
  printf '%s' "$result_url$url" | $(xsel -i -b)
  printf 'Result copied to the clipboard: %s' "$result_url$url"


else
  printf '%s\n' "Not a recognized image type"
fi
