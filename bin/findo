#!/usr/bin/env bash

RED='\033[0;31m'
NC='\033[0m'

usage() {
    cat <<EOF
    findo stands for Find Occurance.
    OPTIONS:
    name   | Name of the string to find.
    -h     | Print this message.
EOF
}

function launch_findo() {
    for filename in $(ls); do
        if [ -d $filename ] && [[ $2 -ne 1 ]]; then
                cd $filename
                launch_findo $1 $(( $2 - 1 ))
                cd ..
        elif [ -f $filename ]; then
            occ="$(cat -b $filename | grep $1)"
            if ((!$?)); then
                printf "${RED}In the file %s${NC}\n" "$filename"
                echo -e "${occ//$1/$RED$1$NC}\n"
            fi
        fi
    done
}

CURRENT_DIR=$(pwd)
str_researched=""
level=0
# http://mywiki.wooledge.org/BashFAQ/035
if (( $# >= 1 )); then
    for i in $@
    do
        case "$i" in
            -h|--help)
                usage
                exit 0
                ;;
            -r|--recursive)
                level=0
                ;;
            -l=*|--level=*)
                level=${i#*=}
                ;;
            *)
                str_researched=$i
                ;;
        esac
    done

    if [ -n $i ]; then
        # If a string was entered.
        printf "LOOKING FOR %s\n" "$str_researched"
        launch_findo $str_researched $level
    else
        usage && exit 1
    fi

else
    usage && exit 1
fi
